machine:
    timezone: Asia/Tokyo
    services:
        - docker

compile:
    override:
        - docker build -t extract-content-dev -f Dockerfile-dev .

test:
    override:
        - docker run -v ${PWD}:/opt/extract-content extract-content-dev py.test --capture=no --junit-xml=build/results.xml
        - docker build -t u6kapps/extract-content .
    post:
        - cp -r build/* $CIRCLE_TEST_REPORTS/

deployment:
    release:
        tag: /.+/
        commands:
            - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
            - docker tag u6kapps/extract-content u6kapps/extract-content:$CIRCLE_TAG
            - docker push u6kapps/extract-content
